#!/usr/bin/env sh
set -e

LOGNAME=${APP_NAME}
LOGDIR=${ROOT_DIR}/logs
mkdir -p logs

LOGFILE=${LOGDIR}/${LOGNAME}__$(date "+%d-%m-%Y_%H-%M-%S").log

# Set default values
BTCWALLET_DB=${BTCWALLET_DB:-${ROOT_DIR}/db/btc-wallet.db}
BTCWALLET_DB_CONN_MAX_LIFE=${BTCWALLET_DB_CONN_MAX_LIFE:-0}
BTCWALLET_DB_MAX_IDLE_CONNS=${BTCWALLET_DB_MAX_IDLE_CONNS:-2}
BTCWALLET_DB_MAX_OPEN_CONS=${BTCWALLET_DB_MAX_OPEN_CONS:-0}
BTCWALLET_LOG_LEVEL=${BTCWALLET_LOG_LEVEL:-info}
BTCWALLET_LOG_FILE=${BTCWALLET_LOG_FILE:-${LOGFILE}}
BTCWALLET_LOG_FORMAT=${BTCWALLET_LOG_FORMAT:-text}
BTCWALLET_LOG_SENTRY_DSN=${BTCWALLET_LOG_SENTRY_DSN:-}
BTCWALLET_LOG_SENTRY_TRACE=${BTCWALLET_LOG_SENTRY_TRACE:-false}
BTCWALLET_LOG_SENTRY_TRACE_LEVEL=${BTCWALLET_LOG_SENTRY_TRACE_LEVEL:-error}

# Run the btc-wallet
./btc-wallet \
  --db=${BTCWALLET_DB} \
  --db_conn_max_lifetime=${BTCWALLET_DB_CONN_MAX_LIFE} \
  --db_max_idle_conns=${BTCWALLET_DB_MAX_IDLE_CONNS} \
  --db_max_open_conns=${BTCWALLET_DB_MAX_OPEN_CONS} \
  --log_level=${BTCWALLET_LOG_LEVEL} \
  --log_file=${BTCWALLET_LOG_FILE} \
  --log_format=${BTCWALLET_LOG_FORMAT} \
  --log_sentry_dsn=${BTCWALLET_LOG_SENTRY_DSN} \
  --log_sentry_trace=${BTCWALLET_LOG_SENTRY_TRACE} \
  --log_sentry_trace_level=${BTCWALLET_LOG_SENTRY_TRACE_LEVEL}
